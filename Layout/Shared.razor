@using DRR_PAGE_BLAZOR.Services
@using DRR_PAGE_BLAZOR.Models
@using System.Text.Json

@inject IJSRuntime JS

<div id="fabContainer" class="fab-container" data-aos="fade-left" data-aos-duration="1000">
    <!-- Botón principal -->  
    <button id="mainFab" type="button" class="fab main-fab pulsing">  
        <i class="fas fa-comments"></i>  
    </button>  

    <!-- Burbuja principal -->  
    <div id="mainBubble" class="fab-bubble main-bubble">Contactanos</div>  

    <!-- Opciones secundarias -->  
    <div class="fab-options">  
        <a href="https://www.youtube.com/channel/UCUCsBcpFKja9bBMaLW7J3cg" class="fab fab-youtube" target="_blank" rel="noopener noreferrer">  
            <i class="fab fa-youtube"></i>  
            <div class="fab-bubble hover-bubble">Youtube</div>  
        </a>  
        <a href="https://www.instagram.com/drrsystemas/?hl=es" class="fab fab-instagram" target="_blank" rel="noopener noreferrer">  
            <i class="fab fa-instagram"></i>  
            <div class="fab-bubble hover-bubble">Instagram</div>  
        </a>  
        <a href="https://www.facebook.com/DRR.Systemas/" class="fab fab-facebook" target="_blank" rel="noopener noreferrer">  
            <i class="fab fa-facebook"></i>  
            <div class="fab-bubble hover-bubble">Facebook</div>  
        </a>  
        <!-- WhatsApp con subopciones -->  
        <div class="fab fab-whatsapp-wrapper">  
            <i class="fab fa-whatsapp"></i>  

            <div class="whatsapp-sub-options">  
                <a href="@($"https://wa.me/{numeroWhatsApp}")" target="_blank" rel="noopener noreferrer" class="fab fab-sub fab-wsp1">
                    <i class="fab fa-whatsapp"></i>  
                    <div class="fab-bubble hover-bubble">Eldorado</div>  
                </a>  
                <a href="https://wa.me/5493764487101" target="_blank" rel="noopener noreferrer" class="fab fab-sub fab-wsp2">  
                    <i class="fab fa-whatsapp"></i>  
                    <div class="fab-bubble hover-bubble">El Posadas</div>  
                </a>  
            </div>  
        </div>

        @if (EmpresaData != null && !string.IsNullOrEmpty(EmpresaData.E_Mail))
        {
            <a href="mailto:@EmpresaData.E_Mail" class="fab fab-email" target="_blank" rel="noopener noreferrer">
                <i class="fas fa-envelope"></i>
                <div class="fab-bubble hover-bubble">E-mail</div>
            </a>
        }

        <!-- Llamar con subopciones -->  
        <div class="fab fab-phone-wrapper">  
            <i class="fas fa-phone"></i>  
            <div class="phone-sub-options">  
                <a href="@($"tel:+{numeroWhatsApp}")" class="fab fab-sub fab-call1">
                    <i class="fas fa-phone"></i>  
                    <div class="fab-bubble hover-bubble">Eldorado</div>  
                </a>  
                <a href="tel:+5493764487101" class="fab fab-sub fab-call2">  
                    <i class="fas fa-phone"></i>  
                    <div class="fab-bubble hover-bubble">Posadas</div>  
                </a>  
            </div>  
        </div>  

        <!-- Ubicación con subopciones -->  
        <div class="fab fab-location-wrapper">  
            <i class="fas fa-location-dot"></i>  
            <div class="location-sub-options">  
                <a href="https://maps.app.goo.gl/YdGohc6JushErwdp8" class="fab fab-sub fab-loc1" target="_blank">  
                    <i class="fas fa-location-dot"></i>  
                    <div class="fab-bubble hover-bubble">Eldorado</div>  
                </a>  
                <a href="https://maps.app.goo.gl/V5c53r6myV9gLRW26" class="fab fab-sub fab-loc2" target="_blank">  
                    <i class="fas fa-location-dot"></i>  
                    <div class="fab-bubble hover-bubble">Posadas</div>  
                </a>  
            </div>  
        </div>  
    </div>  
</div>  

@code {
    [Parameter]
    public Empresa? EmpresaData { get; set; }
    private string numeroWhatsApp = "";

    protected override async Task OnAfterRenderAsync(bool firstRender)  
    {  
        if (firstRender)  
        {  
            await JS.InvokeVoidAsync("setupFab");  
        }  
    }

    protected override void OnParametersSet()
    {
        // Este método se llama cada vez que se establece un parámetro (como EmpresaData)
        if (EmpresaData != null)
        {
            var telefono = EmpresaData.telefono ?? "";
            telefono = telefono.Replace("-", "").Replace(" ", "");
            if (telefono.StartsWith("0"))
                telefono = telefono.Substring(1);
            numeroWhatsApp = $"549{telefono}";
        }
    }

    [Inject] public IJSRuntime JSRuntime { get; set; } = default!;
    private async Task ScrollToSection(string sectionId)
    {
        await JSRuntime.InvokeVoidAsync("scrollToSection", sectionId);
    }
}
